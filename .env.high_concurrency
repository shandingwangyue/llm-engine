# 高并发优化配置 - 支持100+并发

# 服务器配置
HOST=127.0.0.1
PORT=8000
WORKERS=4  # 增加工作进程数
LOG_LEVEL=info

# 模型配置
MODEL_DIR=./models
DEFAULT_MODEL=gpt-oss-20b-Q8_0  # 使用现有模型
AUTO_LOAD_MODELS=true

# 性能配置 - 优化并发参数
MAX_CACHE_SIZE=2000  # 增加缓存容量
CACHE_TTL=600  # 延长缓存时间
MAX_CONCURRENT_REQUESTS=200  # 提高并发限制
MAX_TOKENS=4096 # 限制生成长度以提高性能

# 内存优化
USE_MMAP=true
USE_MLOCK=false
N_THREADS=8  # 增加推理线程数
N_BATCH=1024  # 增加批处理大小

# 异步推理配置
ASYNC_QUEUE_SIZE=1000  # 异步队列大小
ASYNC_WORKER_THREADS=16  # 异步工作线程数
ASYNC_MAX_BATCH_SIZE=8  # 最大批处理大小

# 监控配置
ENABLE_MONITORING=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=10  # 更频繁的健康检查

# 安全配置
API_KEYS=your-high-perf-key-1,your-high-perf-key-2
ENABLE_AUTH=false
RATE_LIMIT_PER_MINUTE=600  # 提高速率限制

# 流式配置
STREAMING_ENABLED=true
STREAMING_CHUNK_SIZE=2  # 增加流式块大小
STREAMING_FLUSH_INTERVAL=0.05  # 更快的刷新间隔

# 模型特定配置
QWEN_CONTEXT_LENGTH=4096
GEMMA_CONTEXT_LENGTH=8192
LLAMA_CONTEXT_LENGTH=2048
GPT_CONTEXT_LENGTH=8192

# 可选：Redis配置（用于分布式缓存）
REDIS_URL=redis://localhost:6379
REDIS_ENABLED=false

# GPU加速配置（如果可用）
USE_GPU=false
N_GPU_LAYERS=0
GPU_DEVICE_ID=0

# 连接池配置
CONNECTION_TIMEOUT=30
REQUEST_TIMEOUT=60
KEEP_ALIVE_TIMEOUT=5

# 性能调优参数
MAX_REQUEST_QUEUE_SIZE=1000
REQUEST_QUEUE_TIMEOUT=30
BATCH_PROCESSING_ENABLED=true
BATCH_TIMEOUT_MS=100